## 活跃池筛选规则

活跃池的目标是从 ~1000 只场内 ETF 中选出 150–300 只流动性充足、走势稳定的标的，作为日常信号和盘中策略的候选集合。本项目采用“硬过滤 + 自适应筛选”的两步法。

### 1. 数据来源

- `data/master/etf_master.csv`：场内 ETF 基础信息。
- `data/daily/{ts_code}.csv`：最近 90 天日 K，筛选时取最新 60 天用于统计。
- 指标字段：
  - `mean_amount_60`：60 日日均成交额
  - `median_amount_60`：60 日成交额中位数
  - `floor_amount_60`：60 日成交额的 10% 分位数（最差 10% 的平均水平）
  - `trade_days_ratio_60`：60 日有成交天数占比
  - `median_range_60`：60 日日内振幅中位数（(high-low)/close）
  - `listed_days`：上市天数
  - `recent_close`：最新收盘价

### 2. 硬过滤（Hard Filters）

先剔除明显不可交易的 ETF：

| 条件                     | 默认阈值 | 备注                                    |
|--------------------------|---------|-----------------------------------------|
| `listed_days`           | ≥ 90    | 确保有足够历史，避免新基金指标不稳定       |
| `trade_days_ratio_60`   | ≥ 0.80  | 60 天里至少有 48 天有成交                 |
| `recent_close`          | ≥ 0.5 元 | 避免过低价位导致盘口跳动                  |
| `median_range_60`       | ≤ 6%    | 剔除盘中振幅过大的冷门或主题型 ETF        |
| `median_amount_60`      | ≥ 3000 万 | 防止靠偶发暴量撑门面                      |
| `mean_amount_60`        | ≥ 5000 万 | 均值足够大，保证整体流动性                 |
| `floor_amount_60`       | ≥ 2000 万 | 最差 10% 的交易日也要维持基本成交额        |

阈值保存在 `config/settings.json -> active_pool.filters`，可根据资金规模和市场环境调整。

### 3. 自适应分位筛选

在通过硬过滤的一批里，再按分位提升门槛，保持活跃池数量在 150–300 只之间：

1. 计算剩余样本的分位点：
   - `mean_amount_60` ≥ P60
   - `median_amount_60` ≥ P55
   - `floor_amount_60` ≥ P45
   - `trade_days_ratio_60` ≥ P60
2. 若结果 <150 只，则把分位降级（P60→P55 等）；若 >300 只，则提高分位（P60→P65）。

此方法可以根据当下市场流动性自动调整，避免固定阈值在牛/熊市下失效。

### 4. 运行方式

```bash
python main.py --active-pool
```

- 默认每 7 天刷新一次（可在配置中改 `active_pool.refresh_interval_days`）。
- 输出文件：`data/universe/active_universe.csv`，按 60 日成交额均值从高到低排序。
- 日志将记录计算覆盖的 ETF 数量、最终筛选数量、耗时。

### 5. 调优建议

- 若在盘面热点高度集中的阶段，可以提升成交额阈值（例如均值 ≥ 1 亿）。
- 要纳入新上市热点时，可降低 `listed_days` 阈值，或跳过振幅限制。
- 行情极差时，可把交易天数占比阈值降至 0.7，以免样本过少。
- 可以根据策略资金量设定“目标样本量”并相应调整分位。
