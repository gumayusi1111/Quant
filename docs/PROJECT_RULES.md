# 项目开发规则

> 目标：保持系统模块化、可维护、容易扩展。

## 1. 禁止硬编码
- 不允许在业务代码里写死 Token、路径、常量阈值等敏感或可配置内容。
- 所有默认值写入 `config/settings.json`（非敏感）或 `config/tokens.json`（敏感，已忽略）。

## 2. 配置集中管理
- 新增参数、数据目录、API 相关设置时，先更新 `config/settings.json`。
- 涉及机密的配置写入 `config/tokens.json`，必要时另外提供 `.template` 版本。
- 读取配置必须通过 `src/utils/config.py` 提供的函数，以便后续扩展。

## 3. 代码结构约束
- `*.py` 文件尽量 ≤ 250 行；单一功能拆分为独立模块或函数。
- 高内聚：一个模块只处理一类职责（例如 `indicator_engine` 只处理指标）。
- 低耦合：模块之间通过清晰接口/数据结构通信，避免循环依赖。
- 需要共享功能时放入 `src/utils/`，并保持无副作用。

## 4. 文档规范
- 每当目录/配置/流程发生改变，立即同步更新 `README.md` 或相关 `docs/*.md`。
- 无用或过时的文档直接删除，避免误导；敏感信息不要保留在文档里。
- 关键流程说明（如系统结构、调度、依赖）集中放在 `docs/`。

## 5. 提交流程（建议）
- 新增模块 → 同步更新 README + 相关 docs。
- 引入第三方依赖 → 在 docs 中记录使用方式，并在 config 中添加必要参数。
- 在提交前检查 `.py` 行数、依赖关系以及配置引用是否符合上述规则。
- **提交/推送审批**：只有在获得所有者确认后，才能执行 `git push` 将改动同步到 GitHub 远程。

## 6. 平台与数据源约束
- 仓库统一托管在 **GitHub**，文档/脚本中提及远程地址或 CI/CD 时一律指向 GitHub，不要写 Gitee。
- Token 使用说明：
  - `tushare.token`（822...）：官方 Tushare 包，只负责历史分钟级数据。
  - `chinadata.token`（b3...）：chinadata 包，用于日 K 及其它 K 线。
- 在代码里引用 provider 时，务必读取 `config/settings.json` 的 `providers` 段，避免写死具体包名。

## 7. 变更沟通
- 删除文件或进行大范围结构调整前，必须先与所有者确认并取得同意。
- 任何重要流程/接口调整，都需要在 PR/说明文档中写明理由与影响范围。

## 8. 测试与文件放置
- 所有测试代码统一放在 `tests/` 目录，按模块建立对应子目录，禁止散落在根目录或业务模块内。
- 新脚本、工具、数据样例必须放入对应子目录（例如 `src/utils/`、`docs/`、`data/`），避免在根目录堆积。
- 临时/实验性脚本要么放入 `sandbox/`（若创建），要么在使用完后删除，不要留在根目录。

## 9. 环境与依赖
- 任何 `pip install`、`python` 命令都必须在激活 `.venv` 后执行（PowerShell: `.\\.venv\\Scripts\\Activate.ps1`）。
- 禁止将依赖安装到全局环境；如发现误装，立即卸载并改在虚拟环境内重装。
- 安装/升级依赖时同步更新 `requirements.txt`，并在 README 中提示他人先激活虚拟环境再安装。
